{% extends 'orders/base.html' %}
{% load humanize %}
{% load static %}

{% block css %}
<link href="{% static 'vendor/css/Anna.css' %}" rel="stylesheet">
<link href="{% static 'vendor/fullcalendar/packages/core/main.css' %}" rel="stylesheet">
<link href="{% static 'vendor/fullcalendar/packages/daygrid/main.css' %}" rel="stylesheet">
<link rel="stylesheet" href="{% static 'vendor/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="{% static 'vendor/fonts/icomoon/style.css' %}">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500&amp;display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'vendor/css/style.css' %}">
{% endblock %}

<script defer="" referrerpolicy="origin"
        src="/cdn-cgi/zaraz/s.js?z=JTdCJTIyZXhlY3V0ZWQlMjIlM0ElNUIlNUQlMkMlMjJ0JTIyJTNBJTIyQ2FsZW5kYXIlMjAlMjM5JTIyJTJDJTIyeCUyMiUzQTAuODYyMzcwNDY4NDM3ODgzMiUyQyUyMnclMjIlM0ExOTIwJTJDJTIyaCUyMiUzQTEwODAlMkMlMjJqJTIyJTNBOTA2JTJDJTIyZSUyMiUzQTE5MjAlMkMlMjJsJTIyJTNBJTIyaHR0cHMlM0ElMkYlMkZwcmV2aWV3LmNvbG9ybGliLmNvbSUyRnRoZW1lJTJGYm9vdHN0cmFwJTJGY2FsZW5kYXItMTklMkYlMjIlMkMlMjJyJTIyJTNBJTIyaHR0cHMlM0ElMkYlMkZhZG1pbmx0ZS5pbyUyRiUyMiUyQyUyMmslMjIlM0EyNCUyQyUyMm4lMjIlM0ElMjJVVEYtOCUyMiUyQyUyMm8lMjIlM0EtMTgwJTJDJTIycSUyMiUzQSU1QiU1RCU3RA=="></script>
<script nonce="d4559d23-3a81-45a9-8705-c5e680139deb">
    (function(w,d){!function(a,b,c,d){a[c]=a[c]||{};a[c].executed=[];a.zaraz={deferred:[],listeners:[]};a.zaraz.q=[];a.zaraz._f=function(e){return function(){var f=Array.prototype.slice.call(arguments);a.zaraz.q.push({m:e,a:f})}};for(const g of["track","set","debug"])a.zaraz[g]=a.zaraz._f(g);a.zaraz.init=()=>{var h=b.getElementsByTagName(d)[0],i=b.createElement(d),j=b.getElementsByTagName("title")[0];j&&(a[c].t=b.getElementsByTagName("title")[0].text);a[c].x=Math.random();a[c].w=a.screen.width;a[c].h=a.screen.height;a[c].j=a.innerHeight;a[c].e=a.innerWidth;a[c].l=a.location.href;a[c].r=b.referrer;a[c].k=a.screen.colorDepth;a[c].n=b.characterSet;a[c].o=(new Date).getTimezoneOffset();if(a.dataLayer)for(const n of Object.entries(Object.entries(dataLayer).reduce(((o,p)=>({...o[1],...p[1]})),{})))zaraz.set(n[0],n[1],{scope:"page"});a[c].q=[];for(;a.zaraz.q.length;){const q=a.zaraz.q.shift();a[c].q.push(q)}i.defer=!0;for(const r of[localStorage,sessionStorage])Object.keys(r||{}).filter((t=>t.startsWith("_zaraz_"))).forEach((s=>{try{a[c]["z_"+s.slice(7)]=JSON.parse(r.getItem(s))}catch{a[c]["z_"+s.slice(7)]=r.getItem(s)}}));i.referrerPolicy="origin";i.src="/cdn-cgi/zaraz/s.js?z="+btoa(encodeURIComponent(JSON.stringify(a[c])));h.parentNode.insertBefore(i,h)};["complete","interactive"].includes(b.readyState)?zaraz.init():a.addEventListener("DOMContentLoaded",zaraz.init)}(w,d,"zarazData","script");})(window,document);
</script>

{% block content %}
<script src="{% static 'vendor/js/date.js' %}"></script>
<main>
    <div class="content">
        <div id="current-week" style="text-align:center;"></div>
    <script>
      var currentWeekElement = document.getElementById('current-week');
      var currentDate = new Date();
      var currentWeek = getWeekNumber(currentDate);

      var startDate = new Date();
      startDate.setDate(currentDate.getDate() - currentDate.getDay() + 1);
      var endDate = new Date(startDate);
      endDate.setDate(startDate.getDate() + 6);

      var startDateString = formatDate(startDate);
      var endDateString = formatDate(endDate);

      currentWeekElement.innerHTML = 'Текущая неделя: ' + startDateString + ' - ' + endDateString;

      function getWeekNumber(date) {
        var newDate = new Date(date);
        newDate.setHours(0, 0, 0, 0);
        newDate.setDate(newDate.getDate() + 4 - (newDate.getDay() || 7));
        var yearStart = new Date(newDate.getFullYear(), 0, 1);
        var weekNumber = Math.ceil(((newDate - yearStart) / 86400000 + 1) / 7);
        return weekNumber;
      }

      function formatDate(date) {
        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();
        return ('0' + day).slice(-2) + '.' + ('0' + month).slice(-2) + '.' + year;
      }
    </script>
 <div id="calendar" class="fc fc-ltr fc-unthemed" style="">

    </div>
</div>
<script src="{% static 'vendor/js/jquery-3.3.1.min.js' %}"></script>
<script src="{% static 'vendor/js/popper.min.js' %}"></script>
<script src="{% static 'vendor/js/bootstrap.min.js' %}"></script>
<script src="{% static 'vendor/fullcalendar/packages/core/main.js' %}"></script>
<script src="{% static 'vendor/fullcalendar/packages/interaction/main.js' %}"></script>
<script src="{% static 'vendor/fullcalendar/packages/daygrid/main.js' %}"></script>
<script>

  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
      plugins: [ 'interaction', 'dayGrid' ],
      defaultDate: '2023-06-12',
      editable: true,
      eventLimit: true, // allow "more" link when too many events,
      locale: 'ru', // Указываем языковой код русской локализации
      events: [
        {% for task in tasks %}
        {
          title: '{{ task.name }}',
          start: '{{ task.date|date:"Y-m-d" }}',
          end: '{{ task.date|date:"Y-m-d" }}',
          description: '{{ task.description }}',
          status: '{{ task.status }}',
          initiator: '{{ task.initiator }}'
        },
        {% endfor %}
      ]
    });

    calendar.render();
  });

</script>
<script src="{% static 'vendor/js/main.js' %}"></script>
<script defer=""
        src="https://static.cloudflareinsights.com/beacon.min.js/v52afc6f149f6479b8c77fa569edb01181681764108816"
        integrity="sha512-jGCTpDpBAYDGNYR5ztKt4BQPGef1P0giN6ZGVUi835kFF88FOmmn8jBQWNgrNd8g/Yu421NdgWhwQoaOPFflDw=="
        data-cf-beacon="{&quot;rayId&quot;:&quot;7cf92f7d0d582d83&quot;,&quot;token&quot;:&quot;cd0b4b3a733644fc843ef0b185f98241&quot;,&quot;version&quot;:&quot;2023.4.0&quot;,&quot;si&quot;:100}"
        crossorigin="anonymous"></script>

{% endblock %}